<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>17.1. Object-Relational Mapping &#8212; C# Web Development  documentation</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/fa/css/all.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/launchcode.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/site.css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="17.2. Accessing Data" href="accessingdata.html" />
    <link rel="prev" title="17. Introduction to Object-Relational Mapping" href="index.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../../_static/js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
<script type="text/javascript" src="../../_static/bootstrap-3.4.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>

  </head><body class="body-bc">

<div id="navbar" class="navbar navbar-default navbar-fixed-top">
   <div class="container">
     <div class="navbar-header">
       <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
       <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
         <span class="icon-bar"></span>
         <span class="icon-bar"></span>
         <span class="icon-bar"></span>
       </button>
       <a class="navbar-brand" href="../../index.html"><span><img src="../../_static/lc-ed-logo.png" alt="LaunchCode logo"></span>
       </a>
       <span class="navbar-text navbar-version pull-left"><b></b></span>
     </div>

       <div class="collapse navbar-collapse nav-collapse">
         <ul class="nav navbar-nav">
           
           
             
           
           
           
           
           
         </ul>

         
           
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
    <label for="q" class="searchLabel">Search</label>
    <input type="text" name="q" class="form-control" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
         
       </div>
   </div>
 </div>

<ol class="breadcrumb container">
    <li><a href="../../index.html">Contents</a></li>
    <li><a href="index.html"><span class="section-number">17. </span>Introduction to Object-Relational Mapping</a></li>
    <li class="active"><span class="section-number">17.1. </span>Object-Relational Mapping</li>
</ol>



<div class="container">
  <div class="row">
    <div class="col-md-10 col-md-offset-1 content " role="main">

    
  <div class="section" id="object-relational-mapping">
<h1><span class="section-number">17.1. </span>Object-Relational Mapping<a class="headerlink" href="#object-relational-mapping" title="Permalink to this headline">¶</a></h1>
<div class="admonition-warning admonition" id="index-0">
<p class="first admonition-title"><i class="fas fa-exclamation-triangle" aria-hidden="true"></i>Warning</p>
<p class="last">Look for notes regarding any changes between the videos, Visual Studio, and Entity Framework Core.
We will provide notes in the text for working with the <code class="docutils literal notranslate"><span class="pre">CodingEventsDemo</span></code> repos as well as
projects you created yourself.</p>
</div>
<p>We are now ready to connect our MVC application to a relational database and add persistent data storage to our apps. To do so, we need to use <em>object-relational mapping</em>.</p>
<p><strong>Object-Relational Mapping</strong> or <strong>ORM</strong> is a technique for converting data between C# objects and relational databases.
ORM converts data between two incompatible type systems (C# and MySQL), such that each model class becomes a table in our database and each instance a row of the table.</p>
<div class="admonition-example admonition">
<p class="first admonition-title"><i class="fas fa-binoculars" aria-hidden="true"></i>Example</p>
<p>Let’s say we have a C# class called <code class="docutils literal notranslate"><span class="pre">ContactInfo</span></code>. <code class="docutils literal notranslate"><span class="pre">ContactInfo</span></code> has three properties: an integer <code class="docutils literal notranslate"><span class="pre">Id</span></code>, a string <code class="docutils literal notranslate"><span class="pre">Name</span></code>, and a string <code class="docutils literal notranslate"><span class="pre">Email</span></code>.
Now we want to store this information in a MySQL database.
We can use ORM so that the database of our application has a table to contain all objects instantiated from the <code class="docutils literal notranslate"><span class="pre">ContactInfo</span></code> class.
The table called <code class="docutils literal notranslate"><span class="pre">contactinfo</span></code> has three columns: an integer <code class="docutils literal notranslate"><span class="pre">Id</span></code>, a varchar <code class="docutils literal notranslate"><span class="pre">Name</span></code>, and a varchar <code class="docutils literal notranslate"><span class="pre">Email</span></code>.</p>
<p>Now, let’s instantiate a C# object:</p>
<div class="highlight-csharp notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="n">ContactInfo</span> <span class="n">frank</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ContactInfo</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="s">&quot;Frank&quot;</span><span class="p">,</span><span class="s">&quot;frank@email.com&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Having set up our application, we can add Frank’s info to our <code class="docutils literal notranslate"><span class="pre">contactinfo</span></code> table.
While we will write the code to add Frank’s info to our database in C#, the frameworks and APIs that make ORM happen will run the following MySQL query for us.</p>
<div class="highlight-mysql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">contactinfo</span> <span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="k">Name</span><span class="p">,</span><span class="n">Email</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="s2">&quot;Frank&quot;</span><span class="p">,</span><span class="s2">&quot;frank@email.com&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p class="last">Now Frank’s info is stored in our MySQL database in the <code class="docutils literal notranslate"><span class="pre">contactinfo</span></code> table!</p>
</div>
<p>To make ORM work in our C# applications, we need an <strong>object-relational mapper</strong> to convert between C# and MySQL.
When we create a new model class and configure it to be stored in a database, a mapper creates a MySQL query to make the corresponding table. In our example above, the query to create the <code class="docutils literal notranslate"><span class="pre">contactinfo</span></code> table from the <code class="docutils literal notranslate"><span class="pre">ContactInfo</span></code> class would be:</p>
<div class="highlight-mysql notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">contactinfo</span> <span class="p">(</span>
   <span class="kt">INT</span> <span class="n">Id</span><span class="p">,</span>
   <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">Name</span><span class="p">,</span>
   <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="n">Email</span>
<span class="p">);</span>
</pre></div>
</td></tr></table></div>
<p>One of the most widely used object-relational mappers available for C# and ASP.NET Core is <strong>Entity Framework Core</strong>. This framework makes use of <strong>data layers</strong>. When we learned about models, we learned that <a class="reference internal" href="../aspdotnet-model-classes/data-layer.html#data-layer-dev"><span class="std std-ref">data layers</span></a> add abstraction between models and the data we want to store. With Entity FrameworkCore, data layers take the form of classes that extend <code class="docutils literal notranslate"><span class="pre">DbContext</span></code>. Models are NOT persistent data stores and relational databases do NOT shape the C# objects we will be using. We want to make sure that the two remain separate.</p>
<div class="admonition-note admonition">
<p class="first admonition-title"><i class="fas fa-sticky-note" aria-hidden="true"></i>Note</p>
<p class="last">We’ll often shorten Entity Framework Core to EF. The “Core” in the name indicates that we’re talking about the version of EF that is compatible with ASP.NET Core.</p>
</div>
<div class="section" id="orm-in-asp-net">
<span id="index-1"></span><h2><span class="section-number">17.1.1. </span>ORM in ASP.NET<a class="headerlink" href="#orm-in-asp-net" title="Permalink to this headline">¶</a></h2>
<p>To enable ORM in our apps, we need to connect our EF mapper to a MySQL database. Let’s do this with <code class="docutils literal notranslate"><span class="pre">CodingEvents</span></code>!</p>
<div class="section" id="setting-up-a-persistent-database-video">
<span id="setup-orm-database"></span><h3><span class="section-number">17.1.1.1. </span>Setting up a Persistent Database - Video<a class="headerlink" href="#setting-up-a-persistent-database-video" title="Permalink to this headline">¶</a></h3>
<p>The following video explains how we can add a MySQL database to our <code class="docutils literal notranslate"><span class="pre">CodingEvents</span></code> application and configure our app to connect to the database.</p>
<div class="admonition-note admonition">
<p class="first admonition-title"><i class="fas fa-sticky-note" aria-hidden="true"></i>Note</p>
<p class="last">If you want to verify what code this video starts with, check out the <a class="reference external" href="https://github.com/LaunchCodeEducation/CodingEventsDemo/tree/enums" target="_blank">enums<i class="fas fa-external-link-alt" aria-hidden="true"></i></a> branch. If you want to verify what code this video ends with, check out the <a class="reference external" href="https://github.com/LaunchCodeEducation/CodingEventsDemo/tree/db-setup" target="_blank">db-setup<i class="fas fa-external-link-alt" aria-hidden="true"></i></a> branch.</p>
</div>

<div style="text-align:center;"><iframe width="800" height="450" src="https://www.youtube.com/embed/RJ0NRG1FjIA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
<p></p>
</div>
<div class="section" id="setting-up-a-persistent-database-text">
<h3><span class="section-number">17.1.1.2. </span>Setting up a Persistent Database - Text<a class="headerlink" href="#setting-up-a-persistent-database-text" title="Permalink to this headline">¶</a></h3>
<p>To get started with using a relational database with our MVC applications, we need to first go to MySQL Workbench.</p>
<p>In MySQL Workbench, do the following:</p>
<ol class="arabic simple">
<li>Create a new schema, <code class="docutils literal notranslate"><span class="pre">coding_events</span></code>.</li>
<li>Add a new user, <code class="docutils literal notranslate"><span class="pre">coding_events</span></code>, with a new password. Give the user all privileges to modify your new schema.</li>
</ol>
<p>Now, attach MySQL to your project in <code class="docutils literal notranslate"><span class="pre">appsettings.json</span></code> by adding the following property.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;ConnectionStrings&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;DefaultConnection&quot;</span><span class="o">:</span> <span class="s2">&quot;server=localhost;userid=coding_events;password=PASSWORD;database=coding_events;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">DefaultConnection</span></code> property contains key/value pairs for each piece of information needed for our app to connect to the database created above. Be sure to replace <code class="docutils literal notranslate"><span class="pre">PASSWORD</span></code> with the password that you used when creating the <code class="docutils literal notranslate"><span class="pre">coding_events</span></code> user above.</p>
<p>We now need to add a couple of NuGet packages to support our database connection. This process differs slightly for Windows and MacOS users.</p>
<div class="section" id="install-mysql-dependency">
<h4><span class="section-number">17.1.1.2.1. </span>Install MySQL Dependency<a class="headerlink" href="#install-mysql-dependency" title="Permalink to this headline">¶</a></h4>
<p><strong>Working with the NuGet Package Manager</strong></p>
<p>Open the NuGet Package Manager in Visual Studio:</p>
<ul class="simple">
<li><strong>Windows</strong> - <em>Tools &gt; NuGet Package Manager &gt; Manage NuGet Packages for Solution</em></li>
<li><strong>Mac</strong> - <em>Project &gt; Manage NuGet Dependencies</em></li>
</ul>
<p>Search for for all of the packages listed below. Select the package and install.</p>
<p>When installing these packages, make sure that the versions are the same as the .NET Core version your project is using.
You can confirm this is the case by reviewing the code in your csproj file.</p>
<p>We will need to install the following NuGet packages:</p>
<ul class="simple">
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">Pomelo.EntityFrameworkCore.MySql</span></code></dt><dd>This dependency provides code that is able to connect to a MySQL database
from within an ASP.NET Core application using EF. Note that this package
itself depends on the following EF packages:</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">Microsoft.EntityFrameworkCore.Relational</span></code></dt><dd>This is a mapping framework that automates access and storage of data in your project’s database.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal notranslate"><span class="pre">Microsoft.EntityFrameworkCore.Design</span></code></dt><dd>This helps manage data migrations and the design-time logic.
<strong>Note:</strong> This was not installed in the video above.
If you do not install it, Entity Framework Core will print an error message asking you to install it.</dd>
</dl>
</li>
</ul>
<div class="admonition-tip admonition">
<p class="first admonition-title"><i class="fas fa-lightbulb" aria-hidden="true"></i>Tip</p>
<p class="last">You can view installed packages and their dependencies by navigating to
<em>Dependencies &gt; NuGet</em> in the Solution Explorer (or the Solution pane on Mac)
and expanding a given package.</p>
</div>
</div>
<div class="section" id="verify-ef-core-tools-are-present">
<h4><span class="section-number">17.1.1.2.2. </span>Verify EF Core Tools are Present<a class="headerlink" href="#verify-ef-core-tools-are-present" title="Permalink to this headline">¶</a></h4>
<p>EF 6.0.X is typically installed with Visual Studio 2022.</p>
<p>You can test that it has been installed by running the following in your terminal.</p>
<ol class="arabic">
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">cd</span></code> your way down into the project folders.
Verify your location by running the <code class="docutils literal notranslate"><span class="pre">ls</span></code> command.  You should see all the folders within your project.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>student-computer:CodingEventsDemo student$ ls
CodingEventsDemo.csproj           ViewModels
Controllers                       Views
Data                              appsettings.Development.json
Models                            appsettings.json
Program.cs                        bin
Properties                        obj
Startup.cs                        wwwroot
</pre></div>
</div>
</li>
<li><p class="first">When you are this level run the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>dotnet ef
</pre></div>
</div>
<p>You should see the following output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>student-computer:CodingEventsDemo student$ dotnet ef

               _/<span class="se">\_</span>_
         ---<span class="o">==</span>/    <span class="se">\\</span>
   ___  ___   <span class="p">|</span>.    <span class="se">\|\</span>
  <span class="p">|</span> __<span class="o">||</span> __<span class="p">|</span>  <span class="p">|</span>  <span class="o">)</span>   <span class="se">\\\</span>
  <span class="p">|</span> _<span class="p">|</span> <span class="p">|</span> _<span class="p">|</span>   <span class="se">\_</span>/ <span class="p">|</span>  //<span class="p">|</span><span class="se">\\</span>
  <span class="p">|</span>___<span class="o">||</span>_<span class="p">|</span>       /   <span class="se">\\\/\\</span>

  Entity Framework Core .NET Command-line Tools <span class="m">6</span>.0.X
</pre></div>
</div>
</li>
</ol>
<div class="admonition-note admonition">
<p class="first admonition-title"><i class="fas fa-sticky-note" aria-hidden="true"></i>Note</p>
<p class="last">We recommend installing either version 6.0.11 or higher</p>
</div>
</div>
<div class="section" id="troubleshooting-ef-core-tools">
<h4><span class="section-number">17.1.1.2.3. </span>Troubleshooting EF Core Tools<a class="headerlink" href="#troubleshooting-ef-core-tools" title="Permalink to this headline">¶</a></h4>
<p>If you are not able to see the Entity Framework Core logo,
then try the following steps to troubleshoot the issue.</p>
<ol class="arabic">
<li><p class="first">Open a terminal window using your terminal app outside of Visual Studio.</p>
</li>
<li><p class="first">Open a terminal and run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ dotnet tool install -g dotnet-ef
</pre></div>
</div>
<p>This command installs a set of command-line tools for working with EF <em>globally</em>,
which means it will be available for any ASP.NET project we use in the future.
We will use the tools provided by this package to update our database schema after adding or changing model classes.</p>
</li>
<li><p class="first">Once you have taken these steps, you are ready to set up the appropriate models and controllers for the application. We’ll do that in the next section.</p>
</li>
<li><p class="first">To test that this install worked, run <code class="docutils literal notranslate"><span class="pre">dotnet</span> <span class="pre">ef</span></code>. The output should be a message displaying basic EF tool commands and options.</p>
</li>
</ol>
<div class="admonition-note-for-mac-users-only admonition">
<p class="first admonition-title">Note for Mac users only</p>
<p>For these tools to be accessible from the command line, they must be within your user path.
We create or update your <a class="reference external" href="https://friendly-101.readthedocs.io/en/latest/bashprofile.html" target="_blank">bash profile<i class="fas fa-external-link-alt" aria-hidden="true"></i></a>.
Your bash profile is a text file that you can add any paths needed.
You may add to this as you continue on your programming journey.</p>
<ol class="last arabic">
<li><p class="first">Open your <code class="docutils literal notranslate"><span class="pre">~/.bash_profile</span></code> with this command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>open ~/.bash_profile
</pre></div>
</div>
<p><a class="reference external" href="https://education.launchcode.org/intro-to-professional-web-dev/chapters/terminal/basic-commands.html" target="_blank">Recall<i class="fas fa-external-link-alt" aria-hidden="true"></i></a>
that <code class="docutils literal notranslate"><span class="pre">~</span></code> is shorthand for your home directory, which is the directory you are in when you open a new terminal window.</p>
</li>
<li><p class="first">Add the following line to the very bottom of your profile:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$PATH</span><span class="s2">:</span><span class="nv">$HOME</span><span class="s2">/.dotnet/tools/&quot;</span>
</pre></div>
</div>
</li>
<li><p class="first">Save and close the file. Then close your terminal window and open a new one, so that the changes can take effect.</p>
</li>
<li><p class="first">To test that this install worked, run <code class="docutils literal notranslate"><span class="pre">dotnet</span> <span class="pre">ef</span></code>. The output should be a message displaying basic EF tool commands and options.</p>
</li>
</ol>
</div>
<p>Once you have taken these steps, you are ready to set up the appropriate models and controllers for the application. We’ll do that in the next section.</p>
</div>
</div>
<div class="section" id="ensuring-connection-success-and-security">
<span id="index-2"></span><h3><span class="section-number">17.1.1.3. </span>Ensuring Connection Success and Security<a class="headerlink" href="#ensuring-connection-success-and-security" title="Permalink to this headline">¶</a></h3>
<p>Before we can get into the ins and outs of using ORM, we need to make sure that our application has a corresponding database and that our application is ready to connect to MySQL. We can start to do this by creating new schemas and setting user privileges in MySQL Workbench. We also <em>must</em> make sure that the MVC application has the correct dependencies, username, and password to access the schema.</p>
<p>If we do not do these steps, then our application will not be able to use a persistent data source.</p>
<p>Setting the value of the <code class="docutils literal notranslate"><span class="pre">DefaultConnection</span></code> property using the values of the username and password is NOT a best practice. We regularly commit our code to Github, meaning anyone who reads the code in our repository can see the username and password. While you can do it for the applications in this class, you do not want to do it in the future.</p>
<div class="admonition-note admonition">
<p class="first admonition-title"><i class="fas fa-sticky-note" aria-hidden="true"></i>Note</p>
<p class="last">To avoid this in the future, you can configure your <code class="docutils literal notranslate"><span class="pre">DefaultConnection</span></code> string to reference <strong>environment variables</strong>. You then hide the appropriate info by setting the environment variable’s value equal to the password, for example.</p>
</div>
<p>See Microsoft <a class="reference external" href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/configuration/?view=aspnetcore-6.0#environment-variables" target="_blank">documentation<i class="fas fa-external-link-alt" aria-hidden="true"></i></a> to learn how to keep the username and password to your database safe and secure.</p>
</div>
</div>
<div class="section" id="check-your-understanding">
<h2><span class="section-number">17.1.2. </span>Check Your Understanding<a class="headerlink" href="#check-your-understanding" title="Permalink to this headline">¶</a></h2>
<div class="admonition-question admonition">
<p class="first admonition-title"><i class="fas fa-question" aria-hidden="true"></i>Question</p>
<p class="last"><strong>True/False:</strong> Writing usernames and passwords in plain text in a file is a GREAT idea!</p>
</div>
<div class="admonition-question admonition">
<p class="first admonition-title"><i class="fas fa-question" aria-hidden="true"></i>Question</p>
<p class="last"><strong>True/False:</strong> An ORM converts data between C# objects and relational databases.</p>
</div>
<div class="admonition-question admonition">
<p class="first admonition-title"><i class="fas fa-question" aria-hidden="true"></i>Question</p>
<p class="last"><strong>True/False:</strong> We need Entity Framework Core AND a MySQL provider to successfully use ORM in this project.</p>
</div>
</div>
</div>



    
    <nav aria-label="Next and Previous Pages">
      <ul class="pager">
        
        <li class="previous"><a href="index.html"><span aria-hidden="true">&larr;</span> <span class="section-number">17. </span>Introduction to Object-Relational Mapping</a></li>
        
        
        <li class="next"><a href="accessingdata.html"><span class="section-number">17.2. </span>Accessing Data <span aria-hidden="true">&rarr;</span></a></li>
        
      </ul>
    </nav>
    
    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="../../_sources/chapters/orm-intro/background.rst.txt"
     rel="nofollow">Page Source</a>
</div>
      
    </p>
    <p>
    </p>
  </div>
</footer>
  </body>
</html>